# name: test/sql/test_list_schemas.test
# description: Test ListSchemas functionality
# group: [snowflake]

require snowflake

# Skip if no credentials
require-env SNOWFLAKE_TEST_ACCOUNT

# Test snowflake_attach which uses ListSchemas internally
statement ok
CREATE OR REPLACE VARIABLE sf_conn VARCHAR = 
    'account=' || '${SNOWFLAKE_TEST_ACCOUNT}' || 
    ';user=' || '${SNOWFLAKE_TEST_USER}' || 
    ';password=' || '${SNOWFLAKE_TEST_PASSWORD}' || 
    ';warehouse=' || '${SNOWFLAKE_TEST_WAREHOUSE}' || 
    ';database=' || '${SNOWFLAKE_TEST_DATABASE}';

# Test listing schemas via snowflake_attach
query II
SELECT COUNT(*) > 0 as has_schemas, 
       COUNT(CASE WHEN schema_name = 'PUBLIC' THEN 1 END) > 0 as has_public
FROM snowflake_attach(getvariable(sf_conn));
----
true	true

# Test that INFORMATION_SCHEMA exists
query I
SELECT COUNT(*) 
FROM snowflake_attach(getvariable(sf_conn))
WHERE schema_name = 'INFORMATION_SCHEMA';
----
1

# Test listing tables in a schema (uses ListTables internally)
query I
SELECT COUNT(*) > 0
FROM snowflake_attach(getvariable(sf_conn))
WHERE schema_name = 'INFORMATION_SCHEMA' 
  AND table_name IS NOT NULL;
----
true